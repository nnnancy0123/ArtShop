<!DOCTYPE html>
<html lang="en" data-bs-theme="light" data-pwa="true">
<meta http-equiv="content-type" content="text/html;charset=utf-8" />

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>管理員 ｜ 商品一覧</title>

	<!-- Custom fonts for this template-->
	<link rel="stylesheet" th:href="@{/vendor/fontawesome-free/css/all.min.css}">
	<link
		href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
		rel="stylesheet">

	<!-- CSS Section -->
	<link th:href="@{/assets/css/sb-admin-2.min.css}" rel="stylesheet">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP:wght@300;400&display=swap" rel="stylesheet">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

	<!-- JavaScript Section -->
	<!-- jQuery should come before Bootstrap's JavaScript -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script th:src="@{/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<!-- DataTables JS -->
	<script type="text/javascript" src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

	<style>
		.custom-modal-width {
			max-width: 750px;
			margin-right: 240px !important;
		}
	</style>
</head>

<body id="page-top">

	<!-- Page Wrapper -->
	<div id="wrapper">
		<!-- 管理員ページスライド -->
		<ul class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion" id="accordionSidebar">

			<!-- Sidebar - Brand -->
			<a class="sidebar-brand d-flex align-items-center justify-content-center" href="index.html">
				<div class="sidebar-brand-icon rotate-n-15">
					<i class="fas fa-laugh-wink"></i>
				</div>
				<div class="sidebar-brand-text mx-3">管理員ページ</div>
			</a>

			<!-- Divider -->
			<hr class="sidebar-divider my-0 border-white">

			<!-- Divider -->
			<hr class="sidebar-divider">
			<!-- 管理員プロフィール編集 -->
			<li class="nav-item">
				<a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseTwo"
					aria-expanded="true" aria-controls="collapseTwo">
					<i class="fas fa-users-cog"></i>
					<span>プロフィール</span>
				</a>
				<div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="admin-profile.html">権限管理</a>
						<a class="collapse-item" href="user-inquiry-list.html">サポート管理</a>

					</div>
				</div>
			</li>
			<!-- ユーザ編集 -->
			<li class="nav-item">
				<a class="nav-link collapsed" href="#" data-toggle="collapse" data-target="#collapseUtilities"
					aria-expanded="true" aria-controls="collapseUtilities">
					<i class="fas fa-user"></i>
					<span>ユーザ管理</span>
				</a>
				<div id="collapseUtilities" class="collapse" aria-labelledby="headingUtilities"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="user-list.html">ユーザ一覧</a>
					</div>
				</div>
			</li>
			<!-- 商品編集 -->
			<li class="nav-item">
				<a class="nav-link" href="charts.html" data-toggle="collapse" data-target="#collapseshopsetting"
					aria-expanded="true" aria-controls="collapseshopsetting">
					<i class="fas fa-cart-arrow-down"></i>
					<span>商品管理</span></a>
				<div id="collapseshopsetting" class="collapse show" aria-labelledby="headingPages"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="product-list.html">商品一覧</a>
						<a class="collapse-item" href="category-settings.html">カテゴリ管理</a>
					</div>
				</div>
			</li>
			<!-- 注文編集 -->
			<li class="nav-item">
				<a class="nav-link" href="#" data-toggle="collapse" data-target="#collapsePages" aria-expanded="true"
					aria-controls="collapsePages">
					<i class="fas fa-clipboard-list"></i>
					<span>注文管理</span>
				</a>
				<div id="collapsePages" class="collapse show" aria-labelledby="headingPages"
					data-parent="#accordionSidebar">
					<div class="bg-white py-2 collapse-inner rounded">
						<a class="collapse-item" href="order-list.html">注文一覧</a>
						<a class="collapse-item" href="order-cancel-return.html">注文キャンセル・返品</a>
						<a class="collapse-item" href="payment-management.html">決済管理</a>
					</div>
				</div>
			</li>
			<!-- Divider -->
			<hr class="sidebar-divider d-none d-md-block">

			<!-- Sidebar Toggler (Sidebar) -->
			<div class="text-center d-none d-md-inline">
				<button class="rounded-circle border-0" id="sidebarToggle"></button>
			</div>
		</ul>
		<!-- 管理員ページスライド　END -->
		<!-- Content Wrapper -->
		<div id="content-wrapper" class="d-flex flex-column">
			<!-- Main Content -->
			<div id="content">
				<!-- Topbar -->
				<nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
					<!-- Sidebar Toggle (Topbar) -->
					<button id="sidebarToggleTop" class="btn btn-link d-md-none rounded-circle mr-5">
						<i class="fa fa-bars"></i>
					</button>
					<!-- Topbar Search -->
					<form
						class="d-none d-sm-inline-block form-inline mr-auto ml-md-3 my-2 my-md-0 mw-100 navbar-search">
						<div class="input-group">
							<input type="text" class="form-control bg-light border-0 small" placeholder="検索する"
								aria-label="Search" aria-describedby="basic-addon2">
							<div class="input-group-append">
								<button class="btn btn-primary" type="button">
									<i class="fas fa-search fa-sm"></i>
								</button>
							</div>
						</div>
					</form>

					<!-- Topbar Navbar -->
					<ul class="navbar-nav ml-auto" style="margin-right:20px">
						<!-- Nav Item - Search Dropdown (Visible Only XS) -->
						<li class="nav-item dropdown no-arrow d-sm-none">
							<a class="nav-link dropdown-toggle" href="#" id="searchDropdown" role="button"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="fas fa-search fa-fw"></i>
							</a>
							<!-- Dropdown - Messages -->
							<div class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
								aria-labelledby="searchDropdown">
								<form class="form-inline mr-auto w-100 navbar-search">
									<div class="input-group">
										<input type="text" class="form-control bg-light border-0 small"
											placeholder="Search for..." aria-label="Search"
											aria-describedby="basic-addon2">
										<div class="input-group-append">
											<button class="btn btn-primary" type="button">
												<i class="fas fa-search fa-sm"></i>
											</button>
										</div>
									</div>
								</form>
							</div>
						</li>
						<!-- Nav Item - Messages -->
						<li class="nav-item dropdown no-arrow mx-1">
							<a class="nav-link dropdown-toggle" href="#" id="messagesDropdown" role="button"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<i class="fas fa-bell fa-fw" style="margin-right:10px"></i>
								<!-- Counter - Messages -->
								<span class="badge badge-danger badge-counter">7</span>
							</a>
							<!-- Dropdown - Messages -->
							<div class="dropdown-list dropdown-menu dropdown-menu-right shadow animated--grow-in"
								aria-labelledby="messagesDropdown">
								<h6 class="dropdown-header">
									メッセージセンター
								</h6>
								<a class="dropdown-item d-flex align-items-center" href="#">
									<div class="dropdown-list-image mr-3">
										<img class="rounded-circle" src="img/undraw_profile_1.svg" alt="...">
										<div class="status-indicator bg-success"></div>
									</div>
									<div class="font-weight-bold">
										<div class="text-truncate">商品が無事に発送されました。</div>
										<div class="small text-gray-500">山田太郎 · 58分前</div>
									</div>
								</a>
								<a class="dropdown-item d-flex align-items-center" href="#">
									<div class="dropdown-list-image mr-3">
										<img class="rounded-circle" src="img/undraw_profile_1.svg" alt="...">
										<div class="status-indicator"></div>
									</div>
									<div>
										<div class="text-truncate">先月の注文について、何か問題がありましたか？</div>
										<div class="small text-gray-500">佐藤花子 · 1日前</div>
									</div>
								</a>
								<a class="dropdown-item d-flex align-items-center" href="#">
									<div class="dropdown-list-image mr-3">
										<img class="rounded-circle" src="img/undraw_profile_3.svg" alt="...">
										<div class="status-indicator bg-warning"></div>
									</div>
									<div>
										<div class="text-truncate">お客様のフィードバックをいただき、ありがとうございました！</div>
										<div class="small text-gray-500">鈴木一郎 · 2日前</div>
									</div>
								</a>
								<a class="dropdown-item d-flex align-items-center" href="#">
									<div class="dropdown-list-image mr-3">
										<img class="rounded-circle" src="img/undraw_profile_3.svg" alt="...">
										<div class="status-indicator bg-success"></div>
									</div>
									<div>
										<div class="text-truncate">購入した商品に大変満足しています。次回もよろしくお願いします。</div>
										<div class="small text-gray-500">田中次郎 · 2週間前</div>
									</div>
								</a>
								<a class="dropdown-item text-center small text-gray-500" href="#">さらにメッセージを表示</a>
						</li>
						<div class="topbar-divider d-none d-sm-block"></div>
						<!-- Nav Item - User Information -->
						<li class="nav-item dropdown no-arrow">
							<a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button"
								data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
								<span class="mr-2 d-none d-lg-inline text-gray-600 small">鈴木</span>
								<img class="img-profile rounded-circle" src="img/undraw_profile.svg">
							</a>
							<!-- Dropdown - User Information -->
							<div class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
								aria-labelledby="userDropdown">
								<a class="dropdown-item" href="admin-login.html">
									<i class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"></i>
									ログアウト
								</a>
							</div>
						</li>
					</ul>
				</nav>
				<!-- Begin Page Content -->
				<div class="container-fluid">
					<!-- Page Heading -->
					<h1 class="h5 mb-2 text-gray-900" style="margin:20px 0px 0px 25px">商品管理</h1>
					<div class="col-lg-12 justify-content-between align-items-center">
						<div class="ps-lg-3 ps-xl-0">
							<!-- 商品登録ボタン -->
							<div class="d-flex justify-content-between mb-4">
								<button class="btn btn-success btn-sm" data-bs-toggle="modal" style="margin-left:12px"
									data-bs-target="#addProductModal">商品登録</button>
							</div>
							<!-- 商品検索とフィルター -->
							<div class="row mb-0">
								<div class="col-md-3" style="position: relative;">
									<input type="text" class="form-control custom-font-select" id="searchProduct"
										placeholder="商品名、商品IDで検索" style="padding-right: 40px;">
									<i class="fa fa-search" aria-hidden="true" id="searchButton"
										style="position: absolute; right: 30px; top: 45%; transform: translateY(-50%); cursor: pointer;color:grey"></i>
								</div>
								<div class="col-md-3">
									<select class="form-select custom-font-select" id="categoryFilter">
										<option value="すべてのカテゴリ">すべてのカテゴリ</option>
										<option value="カテゴリA">ぬいぐるみ</option>
										<option value="カテゴリB">洋服</option>
									</select>
									<style>
										.custom-font-select {
											font-family: 'IBM Plex Sans JP', sans-serif;
											font-size: 12px;
											font-weight: 400;
											color: #333;
										}
									</style>
								</div>
								<div class="col-md-2">
									<button class="btn btn-primary w-100 btn-sm"
										onclick="filterProducts()">フィルタ</button>
								</div>
							</div>
							<!-- 商品一覧 テーブル -->
							<div class="py-5">
								<div class="row justify-content-center">
									<div class="col-md-12">
										<div class="card mb-5">
											<div class="card-header d-flex justify-content-between align-items-center py-3"
												style="background-color:rgb(90, 109, 248)">
												<h2 class="h5 mb-0 text-white" style="margin-left: 8px;">商品一覧</h2>
											</div>
											<div class="table-responsive mt-3">
												<table class="table table-bordered table-striped" id="productTable">
													<thead>
														<tr class="text-dark">
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 8%;font-size: 14px;">
																商品ID</th>
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 9%;font-size: 14px;">
																商品画像</th>
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 8%;font-size: 14px;">
																商品名</th>
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 9%;font-size: 14px;">
																価格</th>
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 10%;font-size: 14px;">
																在庫状態</th>
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 10%;font-size: 14px;">
																在庫件数</th>
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 10%;font-size: 14px;">
																カテゴリ</th>
															<th scope="col"
																style="font-weight:100; padding-left: 20px; width: 16%;font-size: 14px;">
																商品紹介</th>
															<th scope="col"
																style="font-weight:300; width: 30%; text-align: center;">
																操作</th>
														</tr>
													</thead>
													<tbody id="productTableBody">
														<tr th:each="product : ${adminProductList}">
															<td th:text="${product.productId}">商品ID</td>
															<td th:text="${product.productPhoto}">商品画像</td>
															<td th:text="${product.productName}">商品名</td>
															<td th:text="${product.price}">価格</td>
															<td th:text="${product.stockStatus}">在庫状態</td>
															<td th:text="${product.stockQuantity}">在庫件数</td>
															<td th:text="${product.categoryName}">カテゴリ</td>
															<td th:text="${product.productDescription}">商品紹介</td>
															<td class="text-center">
																<button class="btn btn-primary btn-sm"
																	th:onclick="'editProduct(' + ${product.productId} + ')'">編集</button>
																<button class="btn btn-danger btn-sm"
																	th:onclick="'confirmDeleteProduct(' + ${product.productId} + ')'">削除</button>
																<button class="btn btn-warning btn-sm"
																	th:onclick="'discontinueProduct(' + ${product.productId} + ')'">販売中止</button>
															</td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
										<!-- 商品登録モーダル -->
										<div class="modal fade" id="addProductModal" tabindex="-1"
											aria-labelledby="addProductModalLabel" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered custom-modal-width"
												style="margin-right:350px;">
												<div class="modal-content">
													<div class="modal-header">
														<h5 class="modal-title" id="addProductModalLabel">新規商品登録</h5>
														<button type="button" class="btn-close btn-sm"
															data-bs-dismiss="modal" aria-label="Close"></button>
													</div>
													<div class="modal-body">
														<!-- 商品登録フォーム -->
														<form id="addProductForm">
															<div class="mb-3">
																<label for="productName" class="form-label">商品名</label>
																<input type="text" class="form-control" id="productName"
																	placeholder="商品名を入力してください">
															</div>
															<div class="mb-3">
																<label for="productPrice" class="form-label">価格</label>
																<input type="text" class="form-control"
																	id="productPrice" placeholder="価格を入力してください">
															</div>
															<div class="mb-3">
																<label for="productStock"
																	class="form-label">在庫件数</label>
																<input type="number" class="form-control"
																	id="productStock" placeholder="在庫件数を入力してください">
															</div>
															<div class="mb-3">
																<label for="productCategory"
																	class="form-label">カテゴリ</label>
																<input type="text" class="form-control"
																	id="productCategory" placeholder="カテゴリを入力してください">
															</div>
															<div class="mb-3">
																<label for="productImage"
																	class="form-label">商品画像</label>
																<input type="file" class="form-control"
																	id="productImage">
															</div>
														</form>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary"
															data-bs-dismiss="modal">閉じる</button>
														<button type="submit" class="btn btn-primary">登録する</button>
													</div>
												</div>
											</div>
										</div>
										<!-- 商品編集モーダル -->
										<div class="modal fade" id="editProductModal" tabindex="-1"
											aria-labelledby="editProductModalLabel" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered">
												<div class="modal-content">
													<div class="modal-header">
														<h5 class="modal-title" id="editProductModalLabel">商品編集</h5>
														<button type="button" class="btn-close btn-sm"
															data-bs-dismiss="modal" aria-label="Close"></button>
													</div>
													<div class="modal-body">
														<form id="editProductForm">
															<div class="mb-3">
																<label for="editProductName"
																	class="form-label">商品名</label>
																<input type="text" class="form-control"
																	id="editProductName">
															</div>
															<div class="mb-3">
																<label for="editProductPrice"
																	class="form-label">価格</label>
																<input type="text" class="form-control"
																	id="editProductPrice">
															</div>
															<div class="mb-3">
																<label for="editProductStock"
																	class="form-label">在庫件数</label>
																<input type="number" class="form-control"
																	id="editProductStock">
															</div>
															<div class="mb-3">
																<label for="editProductCategory"
																	class="form-label">カテゴリ</label>
																<input type="text" class="form-control"
																	id="editProductCategory">
															</div>
															<!-- 画像プレビュー -->
															<div class="mb-3">
																<label for="editProductImagePreview"
																	class="form-label">現在の画像</label>
																<img id="editProductImagePreview" src="" alt="商品画像"
																	style="width: 100px; height: 100px;">
															</div>
															<!-- 画像変更 -->
															<div class="mb-3">
																<label for="editProductImage"
																	class="form-label">新しい画像をアップロード</label>
																<input type="file" class="form-control"
																	id="editProductImage" accept="image/*">
															</div>
															<!-- 商品紹介 -->
															<div class="mb-3">
																<label for="editProductDescription"
																	class="form-label">商品紹介</label>
																<textarea class="form-control"
																	id="editProductDescription" rows="3"></textarea>
															</div>
														</form>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary"
															data-bs-dismiss="modal">閉じる</button>
														<button type="button" class="btn btn-primary"
															onclick="saveProductChanges()">保存する</button>
													</div>
												</div>
											</div>
										</div>
										<!-- 削除モーダル -->
										<div class="modal fade" id="deleteConfirmModal" tabindex="-1"
											aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered">
												<div class="modal-content">
													<div class="modal-header">
														<h5 class="modal-title" id="deleteConfirmModalLabel">削除確認</h5>
														<button type="button" class="btn-close" data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<div class="modal-body">
														本当に削除しますか？
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary"
															data-bs-dismiss="modal">キャンセル</button>
														<button type="button" class="btn btn-danger"
															id="confirmDeleteButton">削除する</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- ページング -->
							<nav aria-label="Page navigation example">
								<ul class="pagination justify-content-center">
									<li class="page-item disabled">
										<a class="page-link" href="#" tabindex="-1" aria-disabled="true">&laquo;</a>
									</li>
									<li class="page-item"><a class="page-link" href="#">1</a></li>
									<li class="page-item"><a class="page-link" href="#">2</a></li>
									<li class="page-item"><a class="page-link" href="#">3</a></li>
									<li class="page-item">
										<a class="page-link" href="#">&raquo;</a>
									</li>
								</ul>
							</nav>
						</div>
					</div>
				</div>
			</div>
			<!-- Footer -->
			<footer class="sticky-footer fs-xs text-center text-sm-start"
				style="border: none; border-top: none; box-shadow: none;">
				<div class="container my-auto">
					<div class="copyright text-center my-auto">
						<span>Copyright &copy; LANLANCOMPANY</span>
					</div>
				</div>
			</footer>
		</div>
	</div>

	<!-- Scroll to Top Button-->
	<a class="scroll-to-top rounded" href="#page-top">
		<i class="fas fa-angle-up"></i>
	</a>
	<!-- Bootstrap core JavaScript-->
	<script src="vendor/jquery/jquery.min.js"></script>

	<!-- Core plugin JavaScript-->
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
	<!-- Bootstrap + Theme scripts -->
	<script th:src="@{/assets/js/theme.min.js}"></script>

	<!-- Custom scripts for all pages-->
	<script th:src="@{/assets/js/sb-admin-2.min.js}"></script>
	<script>
		function fetchProductData() {
			fetch('/api/product')
				.then(response => response.json())
				.then(data => {
					products.push(...data);
					loadProducts();
				})
				.catch(error => console.error('Error loading products:', error));
		}

		const products = [];

		function loadProducts() {
			const tableBody = document.getElementById('productTableBody');
			tableBody.innerHTML = '';

			products.forEach(product => {
				let images = '';
				if (Array.isArray(product.image)) {
					images = product.image.map(img => `<img src="${img}" alt="${product.name}" style="width: 50px; height: 50px; margin-right: 5px;">`).join('');
				} else {
					images = `<img src="${product.image}" alt="${product.name}" style="width: 50px; height: 50px; margin-right: 5px;">`;
				}

				const row = `
            <tr>
                <td style="font-weight:100;font-size: 12px;text-align:center">${product.id}</td>
                <td style="white-space: nowrap;">${images}</td>
                <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.name}</td>
                <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.price}</td>
                <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.stockStatus}</td>
                <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.stockCount}</td>
                <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.categoryName}</td>
                <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.description}</td>
                <td class="text-center">
                    <button class="btn btn-primary btn-sm" onclick="editProduct(${product.id})">編集</button>
                    <button class="btn btn-danger btn-sm" onclick="confirmDeleteProduct(${product.id})">削除</button>
                    <button class="btn btn-warning btn-sm" onclick="discontinueProduct(${product.id})">販売中止</button>
                </td>
            </tr>`;
				tableBody.innerHTML += row;
			});
		}
		document.addEventListener('DOMContentLoaded', fetchProductData);

		// 商品データをモーダルにロード
		function loadProductDetails(id) {
			const product = products.find(p => p.id === id);
			if (product) {
				document.getElementById('editProductName').value = product.name;
				document.getElementById('editProductPrice').value = product.price;
				document.getElementById('editProductStock').value = product.stockCount;
				document.getElementById('editProductCategory').value = product.category;

				// 最初の画像のみ表示
				document.getElementById('editProductImagePreview').src = product.image[0];
			}
		}

		// 商品編集モーダルを表示
		function editProduct(id) {
			const product = products.find(p => p.id === id);
			if (product) {
				document.getElementById('editProductName').value = product.name;
				document.getElementById('editProductPrice').value = product.price;
				document.getElementById('editProductStock').value = product.stockCount;
				document.getElementById('editProductCategory').value = product.category;
				document.getElementById('editProductDescription').value = product.description; // 商品紹介をロード

				// 最初の画像のみ表示
				document.getElementById('editProductImagePreview').src = product.image[0];

				// 編集モーダルを開く
				const editModal = new bootstrap.Modal(document.getElementById('editProductModal'));
				editModal.show();
			}
		}
		// 商品の変更を保存
		function saveProductChanges() {
			const id = products.find(p => p.name === document.getElementById('editProductName').value).id;
			const product = products.find(p => p.id === id);
			if (product) {
				product.name = document.getElementById('editProductName').value;
				product.price = document.getElementById('editProductPrice').value;
				product.stockCount = document.getElementById('editProductStock').value;
				product.category = document.getElementById('editProductCategory').value;
				product.description = document.getElementById('editProductDescription').value; // 商品紹介を保存

				// 新しい画像のアップロードを処理
				const newImages = document.getElementById('editProductImage').files;
				if (newImages.length > 0) {
					product.image = [];  // 旧画像をクリア
					for (let i = 0; i < newImages.length; i++) {
						const reader = new FileReader();
						reader.onload = function (e) {
							product.image.push(e.target.result); // 新しい画像を配列に追加
							if (i === newImages.length - 1) {
								filterProducts();  // 全て処理完了後にテーブルを更新
							}
						};
						reader.readAsDataURL(newImages[i]); // 各画像をData URLに変換
					}
				} else {
					filterProducts();  // 画像に変更がない場合はすぐにテーブルを更新
				}

				document.getElementById('editProductForm').reset();
				const editModal = bootstrap.Modal.getInstance(document.getElementById('editProductModal'));
				editModal.hide(); // モーダルを閉じる
			}
		}
		// 商品検索とフィルター機能
		function filterProducts() {
			const searchValue = document.getElementById('searchProduct').value.toLowerCase();
			const categoryFilter = document.getElementById('categoryFilter').value;
			const filteredProducts = products.filter(product => {
				const matchesSearch = product.name.toLowerCase().includes(searchValue) || product.id.toString().includes(searchValue);
				const matchesCategory = categoryFilter === 'すべてのカテゴリ' || product.category === categoryFilter;
				return matchesSearch && matchesCategory;
			});

			const tableBody = document.getElementById('productTableBody');
			tableBody.innerHTML = ''; // テーブルをクリア
			filteredProducts.forEach(product => {
				const images = product.image.map(img => `<img src="${img}" alt="${product.name}" style="width: 50px; height: 50px; margin-right: 5px;">`).join('');

				const row = `
            <tr>
                <td>${product.id}</td>
                <td>${images}</td> <!-- 横向きに画像を表示 -->
                <td>${product.name}</td>
                <td>${product.price}</td>
                <td>${product.stockStatus}</td>
                <td>${product.stockCount}</td>
                <td>${product.category}</td>
                <td class="text-center">
                <button class="btn btn-primary btn-sm" onclick="editProduct(${product.id})">編集</button>
                <button class="btn btn-danger btn-sm" onclick="deleteProduct(${product.id})">削除</button>
                <button class="btn btn-warning btn-sm" onclick="discontinueProduct(${product.id})">販売中止</button>
                </td>
            </tr>`;
				tableBody.innerHTML += row;
			});
		}

		// 商品の削除機能
		let productIdToDelete = null; // 削除する商品IDを記録

		// 削除確認モーダルを表示
		function confirmDeleteProduct(id) {
			productIdToDelete = id;
			const deleteModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
			deleteModal.show();
		}

		// 削除確認後に商品を削除
		function deleteConfirmedProduct() {
			if (productIdToDelete !== null) {
				const index = products.findIndex(product => product.id === productIdToDelete);
				if (index > -1) {
					products.splice(index, 1); // 配列から商品を削除
					filterProducts(); // テーブルをリフレッシュ

					// 削除確認モーダルを閉じる
					const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
					deleteModal.hide();
				}
			}
			// productIdToDeleteをクリアして重複削除を防ぐ
			productIdToDelete = null;
		}
		function renderProductRow(product) {
			const images = product.image.map(img => `<img src="${img}" alt="${product.name}" style="width: 50px; height: 50px; margin-right: 5px;">`).join('');
			return `
           <tr>
            <td style="font-weight:100;font-size: 12px;text-align:center">${product.id}</td>
            <td style="white-space: nowrap;">${images}</td>
            <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.name}</td>
            <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.price}</td>
            <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.stockStatus}</td>
            <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.stockCount}</td>
            <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.category}</td>
            <td style="font-weight:100; padding-left: 20px;font-size: 12px;">${product.description}</td>
            <td class="text-center">
                <button class="btn btn-primary btn-sm" onclick="editProduct(${product.id})">編集</button>
                <button class="btn btn-danger btn-sm" onclick="confirmDeleteProduct(${product.id})">削除</button>
                <button class="btn btn-warning btn-sm" onclick="discontinueProduct(${product.id})">販売中止</button>
            </td>
          </tr>`;
		}

		function filterProducts() {
			const tableBody = document.getElementById('productTableBody');
			tableBody.innerHTML = products.map(product => renderProductRow(product)).join('');
		}
		// 削除確認ボタンがクリックされた時にトリガー
		document.getElementById('confirmDeleteButton').addEventListener('click', deleteConfirmedProduct);

		// 販売中止機能
		function discontinueProduct(id) {
			const product = products.find(product => product.id === id);
			if (product) {
				product.stockStatus = '販売中止'; // 状態を更新
				filterProducts(); // 更新後の結果を再表示
			}
		}

		// 初期ロード
		document.getElementById('searchProduct').addEventListener('keypress', function (e) {
			if (e.key === 'Enter') {
				filterProducts();  // 検索を実行
			}
		});
	</script>
</body>

</html>